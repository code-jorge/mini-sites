## Multi-factor Authentication

Proof of concept on how 2FA works.

### How MFA works

This is typically based on having the user introduce 2 forms of identification, one they know, and one they have. 


The first one (something they know) is typically an email / password combination (which is something they know).
Sometimes companies will ask for a username instead of an email, or rely on a 3rd party authentication provider (like Google or Facebook) to handle the authentication.

The second one (something they have) usually relies in either biometric identification (like fingerprint or face recognition) or a physical device (like a smartphone or a security key).

This page explores this second step, and particularly how it works with 2FA codes that rotate every 30 seconds. These are usually referred to as TOTP (Time-based One-Time Password) codes.

### How TOTP works

#### Establishing a secret

- A secret is created and stored in both the server and a user's device (typically a smartphone). This secret is a string of random characters. Since no human is meant to memorize the secret, it is usually considerably long and complex, making it nearly impossible to brute force it.

- The secret is usually encoded in a QR code that most 2FA apps can scan and store in the device. Most 2FA apps also allow the user to manually enter the secret, but because it's very long and complex, it's usually much easier to just scan the QR code!

- Once the secret is stored in the device, the server should usually never display it again. Once both a user device and the server have the secret, they can both generate the same TOTP codes, and that's all they need to rely on for authentication.
Exposing the secret would allow an attacker to generate the same TOTP codes, and thus bypass the 2FA.

#### Generating a TOTP code

- The TOTP code is generated by hashing the secret and the current time. 
  - The hashing algorithm used is usually SHA-1, SHA-256 or SHA-512. 
  - The current time is usually represented as the number of seconds since the Unix epoch (January 1st, 1970 at 00:00:00 UTC).
  - The time step is usually 30 seconds, meaning that the current time is rounded down to the nearest multiple of 30 seconds.
  - The resulting hash is usually truncated to 6 digits.
  
> Note that all these options are parameters that are agreed upon by the server and the user's device during the setup, these are just the common defaults.

- As long as both the user's device and the server are on the same time, they will generate the same TOTP code. Which is used to authenticate the user. The 30 second window allows for some clock drift between the server and the user's device, and also gives time for the user to type in the code and network latency.

[![Deploy to Netlify](https://www.netlify.com/img/deploy/button.svg)](https://app.netlify.com/start/deploy?repository=https://github.com/code-jorge/netlify-sites&base=mfa-auth)